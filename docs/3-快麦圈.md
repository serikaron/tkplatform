# 快麦圈爬虫说明

## 1. 登录

### 1.1 登录页面

* url: http://m.kmq999.com/login
* method: GET
* rsp html
    * 需要从 `head`里，取出`name="csrf-token"`的`meta`tag，然后取出content值

        ```html
        <head>
            <meta name="csrf-token" content="0ChMMAAK4UZDKN0lRQxAe1pwimF9gTCtlSzMXntI">
        </head>
        ```

### 1.2 登录

* url: http://m.kmq999.com/login
* method: POST
* body: form
    * _token为页面中取出的content值
    * captcha可以为空

      | key      | value                                    |
                  |----------|------------------------------------------|
      | _token   | 0ChMMAAK4UZDKN0lRQxAe1pwimF9gTCtlSzMXntI |
      | phone    | 13587021931                              |
      | password | hxy197984                                |
      | captcha  |                                          |

## 2. 买号/抢单

### 2.1 买号token

* url: http://m.kmq999.com/app/buyer/index
* method: GET
* rsp html
    * 需要从 `head`里，取出`name="csrf-token"`的`meta`tag，然后取出content值

        ```html
        <head>
            <meta name="csrf-token" content="wUVqdztP8gSryZBxD3kkJ3jsw6PSdzcrVr2UXFfc">
        </head>
        ```

### 2.2 买号
* url: http://m.kmq999.com/app/buyer/tasks/step1
* method: GET
* rsp html
    * 查找`class="section"`的div(`div1`)
    * 遍历`div1`中每个class含有row的div(`div2`)
    * `div2`中找到`class="h6"`的div，取出买号名称
    * `div2`中找到`Button`tag，从`data-url`中得到抢单url
      ```html
      <div class="section">
          <div class="row no-gutters py-4 border-bottom ml-3">
              <div class="col-8">
                  <div class="h6">黄山清哈哈哈</div>
                  <div class="text-muted">淘宝网</div>
              </div>
              <div class="col-4">
                  <button data-url="http://m.kmq999.com/app/buyer/tasks/dispatcher/1858" class="btn btn-primary dispatcher"
                          disabled="disabled">派单中...
                  </button>
              </div>
          </div>
      </div>
      ```

### 2.3 抢单
* url: http://m.kmq999.com/app/buyer/tasks/dispatcher/1858 ，url为第2步中中得到的url
* method: POST
* header: 需要加上`X-CSRF-TOKEN:wUVqdztP8gSryZBxD3kkJ3jsw6PSdzcrVr2UXFfc`，token值在2.1中获得

### 2.4 查单
* url: http://m.kmq999.com/app/buyer/tasks/has_order
* method: POST
* header: 需要加上`X-CSRF-TOKEN:wUVqdztP8gSryZBxD3kkJ3jsw6PSdzcrVr2UXFfc`，token值在2.1中获得
* rsp: 返回0。返回值可能是可以接单数
