# 抖佣爬虫说明

## 1. 登录

### 1.1 验证码

* url: http://sk.zhaocm88.com/Login
* method: GET
* rsp html
    * 查找`id="captchaImg"`的`img`，从src中得到图片url
    * 拼接图片URL并下载展示，由用户输入验证码
    * 例如，
        * `src="/Login/CaptchaImage?r=t1692424274153r0.11738824151277671"`
        * 拼接`host:http://sk.zhaocm88.com`
        * 得到`http://sk.zhaocm88.com/Login/CaptchaImage?r=t1692424274153r0.11738824151277671`

  ```html
  <img class="rounded-pill text-white ms-4" id="captchaImg" data-url="/Login/CaptchaImage" onclick="RefreshCaptcha(this)"
       src="/Login/CaptchaImage?r=t1692424274153r0.11738824151277671">
  </img>
  ```

### 1.2 登录

* url: http://sk.zhaocm88.com/Login/Login
* method: POST
* body form
    * Captcha 由用户输入
    * Code 填空

      | key      | value       |
                                                    |----------|-------------|
      | UserName | 13587021931 |
      | Password | hxy197984   |
      | Captcha  | 1234        |
      | Code     |             |

* rsp `Code:0`为成功
  ```json
  {
      "Value": "/Home/Welcome",
      "Code": 0,
      "Success": true,
      "Message": null
  }
  ```
* 登录成功会set cookie，之后的请求需要在header带上`SanPoss.AUTH.MaDou:<cookie>`

## 2. 买号

* url: http://sk.zhaocm88.com/User/AccountsIndex
* method: GET
* rsp html
    * 查找`class="account-list"`的div，下面的每个子div为一个买号div
    * 每个买号div
        * 查找`<a>`标签，取出href属性`href="/User/EditAccounts/17817"`，以`/`分割字符串，最后的`17817`为买号id
        * 查找第一个`<span>`标签，text内容为买号名称

      ```html
      <div class="account-list">
          <div class="account-detail bg-white radius shadow d-flex align-items-center position-relative p-3 mt-3">
              <a class="btn-link-mask" href="/User/EditAccounts/17817"></a>
              <img class="rounded-pill me-2" src="/Content/images/platform/0.png" width="42" height="42"/>
              <div class="flex">
                  <div class="d-flex align-items-center">
                      <span>郭德纲苦命</span>
                      <span class="btn btn-outline-success btn-xs ms-2">审核通过</span>
                  </div>
  
              </div>
              <i class="fal fa-chevron-right text-black-50"></i>
          </div>
      </div>
      ```

## 3. 接单

* url: http://sk.zhaocm88.com/ReceiptTask/GetReceiptOrder
* method: POST
* body form
    * id 为买号id
    * taskType,refundType 意义不明，分别填 pay,all

      | key        | value |
                        |------------|-------|
      | id         | 17817 |
      | taskType   | pay   |
      | refundType | all   |
* rsp
    * `Success:false` 抢不到单
      ```json
      {
          "Value": null,
          "Code": 0,
          "Success": false,
          "Message": "预计2023-08-19 22:00:00有新订单放出"
      }
      ```
    * 暂缺抢单成功样例

## 4. 余额查询

* url: http://sk.zhaocm88.com/Home/Index
* method: GET
* rsp html
    * 查找`class="user-statistics"`的div, 查找下面第一个`<b>`标签，text为余额

      ```html
      <div class="user-statistics bg-white d-flex text-center p-3">
          <a class="flex" href="/Account">
              <b class="text-md text-black">0</b>
              <p class="text-xs text-black-50">钱包余额</p>
          </a>
          <a class="flex" href="/Account?type=2">
              <b class="text-md text-black">0</b>
              <p class="text-xs text-black-50">累计收益</p>
          </a>
          <a class="flex" href="/Account?type=1">
              <b class="text-md text-black">0.00</b>
              <p class="text-xs text-black-50">提现中</p>
          </a>
          <a class="flex" href="/Order">
              <b class="text-md text-black">0</b>
              <p class="text-xs text-black-50">总接单量</p>
          </a>
      </div>
      ```