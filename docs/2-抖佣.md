# 抖佣爬虫说明

## 1. 登录

### 1.1 登录页面

* url: http://dy.honlly.com.cn/Wap/Account/Login
* method: GET

### 1.2 登录

* url: http://dy.honlly.com.cn/api/account/userLogin
* method: POST
* body: form
    * loginType, roleType 意义未知，先固定为1

      | key       | value       |
                |-----------|-------------|
      | userName  | 13587021931 |
      | passWord  | hxy197984   |
      | loginType | 1           |
      | roleType  | 1           |

* rsp code为`0`是登录成功
  ```json
  {
      "msg": "登录成功!",
      "code": 0
  }
  ```
* 登录会返回cookie，需要在登录页面会话里调用，后续接口也需要在相同会话里调用

## 2. 买号

* url: http://dy.honlly.com.cn/Wap/Home/GetBuyList?plat=0
* method: GET
* rsp:
    * code为0返回成功
    * list下面遍历每个元素取出`id`(抢单用到)，`Account`(买号名称)
      ```json
      {
          "code": 0,
          "msg": "加载完成",
          "list": [{
              "Id": 44879,
              "Account": "ai永远快乐",
              "PlatformId": 1,
              "PlatIcon": "/Image/public/ico/tb_ico.jpg",
              "Sex": "男",
              "Ages": "18-30岁",
              "AccountLevel": "一钻号",
              "GoodsName": "张磊",
              "GoodsTel": "18122417933",
              "GoodsProvince": "山西省",
              "GoodsCity": "太原市",
              "GoodsArea": "杏花岭区",
              "GoodsAddress": "九鑫蓝庭小区32号"
          }]
      }
      ```

## 3. 抢单

### 3.1 抢单

* url: http://dy.honlly.com.cn/Wap/Home/OneKeyReceiptStart
* method: POST
* body: form
    * buyerId 为买号列表中得到的id

      | key        | value |
              |------------|-------|
      | isMobile   | 0     |
      | platformId | 0     |
      | buyerId    | 44879 |
      | minPrice   | 0.00  |
      | maxPrice   | 0.00  |
      | capToken   |       |

* rsp: code为0返回调用成功，抢单结果根据查单处理

### 3.2 查单

* url: http://dy.honlly.com.cn/Api/TaskMoney/GetMyTaskList?page=1&limit=10&state=1&platformId=0
* method: GET
* rsp:
    * 抢单结果
        * 抢单前先查询一次，记下第一个item的Id(没有的话记录0) - `Id1`
        * 调用抢单后，定时查单，如果查到有比`Id1`大的，当成抢单成功
    * 本金:`UnitPrice`, 佣金:`Commission`
      ```json
      {
        "code": 0,
        "msg": "加载完成",
        "count": 0,
        "list": [
          {
            "Id": 1195290,
            "TaskId": 145576,
            "TaskUserId": 20376,
            "PlatformId": 1,
            "IconPath": "/Image/public/ico/tb_ico.jpg",
            "State": "已发货",
            "AuxState": "初始状态",
            "ShopId": 1010,
            "AccepterId": 16450,
            "AcceptTime": "2023-07-28 14:24:50",
            "AccountId": 44875,
            "OrderNo": "1940327904531248675",
            "ExpressCode": "",
            "LookGoodsTime": "2023-07-28 14:29:35",
            "PayTime": "2023-07-28 14:34:49",
            "SendTime": "2023-07-29 14:34:55",
            "RecTime": "暂无",
            "FinishTime": "暂无",
            "NotTaskCancelTime": "07月28号14点44分",
            "NotPayCancelTime": "07月28号15点24分",
            "GoodsName": "适**E3",
            "GoodsPic": "//gw1.alicdn.com/tfscom/tuitui/i1/2457264164/O1CN01VuMyQT1gdA53CWYn1_!!0-item_pic.jpg",
            "UnitPrice": 441.00,
            "Commission": 4.00,
            "TaskTip": "所有搭配链接都要拍多数量，若有差价，提交实付价格即可！！千万不要只拍数量1个，拍错全部退款处理",
            "TaskRefundType": 1,
            "BuyName": "tb26171952",
            "MakeMoneyType": "0",
            "MakeMoneyName": null,
            "isCancelOrder": false,
            "isComplaints": true,
            "ComplaintsText": "活动投诉",
            "ShopName": "港**舰店",
            "IsUrge": 0
          }
        ]
      }
      ```
      
## 4. 站点余额

* url: http://dy.honlly.com.cn/Wap/User/GetUserInfo
* method: GET
* rsp 余额: `data.money`
    
    ```json
    {
      "code": 0,
      "msg": "完成",
      "data": {
        "Id": 16450,
        "msgCount": 7,
        "userName": "15225853373",
        "headPic": "/Image/public/headpic.png",
        "money": 0.00,
        "inMoney": 0,
        "userLevel": "金牌",
        "userLevelIcon": "/Image/Public/user_level_jin.jpg",
        "userPoint": 70,
        "upgradePoint": 100,
        "orderCountDsh": 0,
        "orderCountYjd": 0,
        "orderCountYfk": 0,
        "orderCountYwc": 0,
        "orderCountYfh": 1,
        "invitationCount": 0,
        "weekInvitationCount": 0,
        "isBindMobile": true,
        "isRealName": true,
        "isBindWithdrawAccount": true
      }
    }
    ```